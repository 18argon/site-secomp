{% extends "base.html" %}
{% import "wtf.html" as wtf %}

{% block content %}
<style>
  .clipboard {background-color: #cccccc;}
</style>
<div class="container pt-4">
  <h2 class="text-center pb-2">URL para formulários do Conteúdo</h2>

  <form method="POST" id="form" action="{{url_for('management.gerar_url_conteudo')}}">
    {{ form.hidden_tag() }}

    <div class="row justify-content-center">
      <div class="col-md-6 form-group">
        <label class="control-label" for="email2">Insira o email do(a) ministrante</label>
        <div class='input-group'>
          <input type="text" class="form-control pb-1" id="email2" placeholder="name@example.com" >
          <div class="text-right input-group-btn">
            <button id="email_adder" type="button" class="btn btn-primary">Adicionar ministrante</button>
          </div>
      </div>
      </div>
      <div class="col-md-1"></div>
      <div class="col-md-3">
        {{ wtf.form_field(form.tipo_atividade) }}
      </div>
      <div class="col-md-2"></div>
    </div>

    <div class="row justify-content-center">
      <div class="col-md-6 pt-2 pb-2" id='email-containerL'></div>
      <div class="col-md-6 pt-2 pb-2" id='email-containerR'></div>
    </div>

    <div class="row justify-content-center pt-3">
      <div class="col-md-4">
        <button type="submit" class="btn btn-primary btn-block">Gerar Nova URL</button>
      </div>
    </div>


    <div class="row justify-content-center pt-4">
      <div class="col-md-12">
        <table class="table text-center">
          <thead>
            <tr>
              <th scope="col">Remover</th>
              <th scope="col">Atividade</th>
              <th scope="col">Título</th>
              <th scope="col">Código da URL</th>
              <th scope="col">Emails</th>
            </tr>
          </thead>
          <tbody>
            {% for url in dict_urls %}
            <tr>
              <td scope="col"><button type='submit' class="btn btn-default" name='removido' value='{{ url.id }}'><i
                    class="fa fa-times"></i></button></td>
              <td scope="col">{{ url.tipo }}</td>
              <td scope="col">{{ url.titulo_atividade }}</td>
              <td scope="col" class="col-md-6">
                <div class="input-group">
                <input id='url{{url.id}}' type="text" readonly="readonly" class="w-75" value="{{ url.codigo_url }}" />
                  <span class='input-group-btn'>
                  <button type='button' class="btn clipboard" data-clipboard-target="#url{{url.id}}" aria-hidden=true>
                      <img src="{{url_for('static', filename='images/clippy.svg')}}" width=16>
                  </button>
                  </span>
                </div>
              </td>
              <td scope="col">
                {% for email in url.emails %}
                {{ email }},&nbsp
                {% endfor %}
              </td>
              {% endfor %}
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </form>
</div>
<script>
  email_count = 0;
  function validateEmail($email) {
    var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
    return emailReg.test($email);
  }

  function remover(num) {
    $('#email2' + parseInt(num)).remove();
    email_count = email_count - 1;
  }

  $('#email_adder').click(function () {
    valor = $('#email2').val()
    if (valor != '' && validateEmail(valor)) {
      email_count = email_count + 1;
      $('#email2').val('');

      if (email_count % 2 == 1) {
        $("#email-containerL").append("<div class='input-group pt-2 pb-2'" + email_count.toString() +
          "'><span class='input-group-btn'><button class='btn btn-default' onclick='remover(" +
          email_count.toString() + ")'><i class='fa fa-times' aria-hidden='true'></i></button></span><input type='text' class='form-control' name='emails[]' value='" + valor +
          "' readonly='readonly'></div>");
      } else {
        $("#email-containerR").append("<div class='input-group pt-2 pb-2'" + email_count.toString() +
          "'><input type='text' class='form-control' name='emails[]' value='" + valor +
          "' readonly='readonly'><span class='input-group-btn'><button class='btn btn-default' onclick='remover(" +
          email_count.toString() + ")'><i class='fa fa-times' aria-hidden='true'></i></button></span></div>");
      }

    }
    else {
      alert('Entre com um email válido')
    }
  })
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<script>
 var clipboard = new ClipboardJS('.btn');
 clipboard.on('success', function(e) {
     console.log(e);
 });
 clipboard.on('error', function(e) {
     console.log(e);
 });
 </script>
{% endblock %}

FAZER UM ENABLE = FALSE no javascript dos emails
